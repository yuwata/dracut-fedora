From 6bc2096cf58c4b52f23ecc1bf8dc301d6122dfb5 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Tue, 26 Jan 2016 14:59:28 +0100
Subject: [PATCH] kernel-modules: join instmods and install all usb/storage

---
 modules.d/90kernel-modules/module-setup.sh | 18 ++++++++----------
 1 file changed, 8 insertions(+), 10 deletions(-)

diff --git a/modules.d/90kernel-modules/module-setup.sh b/modules.d/90kernel-modules/module-setup.sh
index 13f48c9..300adc7 100755
--- a/modules.d/90kernel-modules/module-setup.sh
+++ b/modules.d/90kernel-modules/module-setup.sh
@@ -39,16 +39,17 @@ installkernel() {
             ehci-hcd ehci-pci ehci-platform \
             ohci-hcd ohci-pci \
             uhci-hcd \
-            xhci-hcd xhci-pci xhci-plat-hcd
-
-        hostonly='' instmods \
+            xhci-hcd xhci-pci xhci-plat-hcd \
             "=drivers/hid" \
             "=drivers/input/serio" \
-            "=drivers/input/keyboard"
+            "=drivers/input/keyboard" \
+            "=drivers/usb/storage"
 
-        instmods yenta_socket scsi_dh_rdac scsi_dh_emc scsi_dh_alua \
-                 atkbd i8042 usbhid firewire-ohci pcmcia hv-vmbus \
-                 usb-storage
+        instmods \
+            yenta_socket scsi_dh_rdac scsi_dh_emc scsi_dh_alua \
+            atkbd i8042 usbhid firewire-ohci pcmcia hv-vmbus \
+            virtio virtio_blk virtio_ring virtio_pci virtio_scsi \
+            "=drivers/pcmcia" =ide
 
         if [[ "$(uname -p)" == arm* ]]; then
             # arm specific modules
@@ -61,9 +62,6 @@ installkernel() {
                 ${NULL}
         fi
 
-        # install virtual machine support
-        instmods virtio virtio_blk virtio_ring virtio_pci virtio_scsi \
-            "=drivers/pcmcia" =ide "=drivers/usb/storage"
 
         find_kernel_modules  |  block_module_filter  |  instmods
 
